<?xml version="1.0" encoding="UTF-8"?>
<jobs xmlns="http://www.demandware.com/xml/impex/jobs/2015-07-01">
    <job job-id="ExportOrder" priority="0">
        <description/>
        <parameters/>
        <flow>
            <context site-id="drschar"/>
            <step step-id="export" type="ExportOrders" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="Created">true</parameter>
                    <parameter name="New">true</parameter>
                    <parameter name="Open">true</parameter>
                    <parameter name="Completed">true</parameter>
                    <parameter name="Failed">true</parameter>
                    <parameter name="Canceled">true</parameter>
                    <parameter name="Replaced">true</parameter>
                    <parameter name="Use Order Export Delay">false</parameter>
                    <parameter name="Confirmation Status">All</parameter>
                    <parameter name="Shipment Status">All</parameter>
                    <parameter name="Payment Status">All</parameter>
                    <parameter name="Export Status">Ready for Export</parameter>
                    <parameter name="FileNamePrefix">Orders</parameter>
                    <parameter name="OverwriteExportFile">false</parameter>
                </parameters>
            </step>
        </flow>
        <flow>
            <context site-id="drschar"/>
            <step step-id="upload" type="custom.CSComponents.FtpUpload" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="ServiceID">drscharSFTP</parameter>
                    <parameter name="FilePattern">Orders-drschar-*</parameter>
                    <parameter name="SourceFolder">src</parameter>
                    <parameter name="TargetFolder">IN</parameter>
                    <parameter name="Recursive">false</parameter>
                    <parameter name="ArchiveFolder">archive</parameter>
                    <parameter name="NoFileFoundStatus">OK</parameter>
                </parameters>
            </step>
        </flow>
        <rules/>
        <triggers>
            <run-once enabled="false">
                <date>2021-07-15Z</date>
                <time>17:35:48.000Z</time>
            </run-once>
        </triggers>
    </job>

    <job job-id="ExportCustomer" priority="0">
        <description/>
        <parameters/>
        <flow>
            <context site-id="drschar"/>
            <step step-id="export" type="custom.CSComponents.ExportCustomers" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="TargetFolder">MarketingCloud</parameter>
                    <parameter name="Filename">subscribed-customers.xml</parameter>
                    <parameter name="Query">custom.subscribed = true OR custom.subscribedCorp = true AND custom.synced= false</parameter>
                    <parameter name="OverwriteExportFile">true</parameter>
                </parameters>
            </step>
        </flow>
        <flow>
            <context site-id="Sites"/>
            <step step-id="upload" type="custom.CSComponents.FtpUpload" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="ServiceID">drscharSFTP</parameter>
                    <parameter name="SourceFolder">src/IMPEX/MarketingCloud</parameter>
                    <parameter name="TargetFolder">IN</parameter>
                    <parameter name="Recursive">false</parameter>
                    <parameter name="ArchiveFolder">archive</parameter>
                    <parameter name="NoFileFoundStatus">OK</parameter>
                </parameters>
            </step>
        </flow>
        <rules/>
        <triggers>
            <run-recurring enabled="false">
                <recurrence>
                    <date-from>2021-07-28Z</date-from>
                    <date-to>2023-12-01Z</date-to>
                    <start-time>04:00:00.000Z</start-time>
                    <interval>1d</interval>
                    <day-of-week/>
                </recurrence>
            </run-recurring>
        </triggers>
    </job>

    <job job-id="Adyen Process" priority="0">
        <description/>
        <parameters/>
        <flow>
            <context site-id="drschar"/>
            <step step-id="Process" type="ExecuteScriptModule" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="ExecuteScriptModule.Module">int_adyen_overlay/cartridge/scripts/job/notifications.js</parameter>
                    <parameter name="ExecuteScriptModule.FunctionName">processNotifications</parameter>
                    <parameter name="ExecuteScriptModule.Transactional">true</parameter>
                    <parameter name="ExecuteScriptModule.TimeoutInSeconds">3600</parameter>
                </parameters>
            </step>
            <step step-id="Clean" type="ExecuteScriptModule" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="ExecuteScriptModule.Module">int_adyen_overlay/cartridge/scripts/job/notifications.js</parameter>
                    <parameter name="ExecuteScriptModule.FunctionName">clearNotifications</parameter>
                    <parameter name="ExecuteScriptModule.Transactional">true</parameter>
                    <parameter name="ExecuteScriptModule.TimeoutInSeconds">3600</parameter>
                </parameters>
            </step>
        </flow>
        <rules/>
        <triggers>
            <run-once enabled="true">
                <date>2018-03-01Z</date>
                <time>18:55:46.000Z</time>
            </run-once>
        </triggers>
    </job>

    <job job-id="RebuildURLs" priority="0">
        <description/>
        <parameters/>
        <split sequential="false">
            <contexts template-ref="template_40">
                <context site-id="drschar"/>
            </contexts>
            <flow-template template-id="template_40">
                <step step-id="RebuildURLs" type="UpdateStorefrontURLs" enforce-restart="false">
                    <description/>
                    <parameters/>
                </step>
            </flow-template>
        </split>
        <rules/>
        <triggers>
            <run-once enabled="false">
                <date>2018-06-25Z</date>
                <time>05:38:35.000Z</time>
            </run-once>
        </triggers>
    </job>

    <job job-id="RemoveOutdatedPayPalTransaction" priority="0">
        <description>
            Removes PaypalNewTransactions custom object that is older than a year with info about PayPal transaction from BM.
        </description>
        <parameters/>
        <flow>
            <context site-id="drschar"/>
            <step step-id="removeCustomObject" type="custom.removePaypalCustomObject" enforce-restart="false">
                <description/>
                <parameters/>
            </step>
        </flow>
        <rules/>
        <triggers>
            <run-recurring enabled="true">
                <recurrence>
                    <date-from>2019-10-25Z</date-from>
                    <start-time>04:00:00.000Z</start-time>
                    <interval>2M</interval>
                    <day-of-week/>
                </recurrence>
            </run-recurring>
        </triggers>
    </job>

    <job job-id="Reindex" priority="0">
        <description/>
        <parameters/>
        <split sequential="false">
            <contexts template-ref="template_45">
                <context site-id="drschar"/>
            </contexts>
            <flow-template template-id="template_45">
                <step step-id="Reindex" type="SearchReindex" enforce-restart="false">
                    <description/>
                    <parameters>
                        <parameter name="Product related search indexes">true</parameter>
                        <parameter name="Active data search index">true</parameter>
                        <parameter name="Content search index">true</parameter>
                        <parameter name="Indexer Type">Full Index Rebuild</parameter>
                    </parameters>
                </step>
            </flow-template>
        </split>
        <rules/>
        <triggers>
            <run-once enabled="false">
                <date>2018-06-25Z</date>
                <time>05:36:56.000Z</time>
            </run-once>
        </triggers>
    </job>

    <job job-id="CatalogImport" priority="0">
        <description/>
        <parameters/>
        <flow>
            <context site-id="Sites"/>
            <step step-id="downdload" type="custom.CSComponents.FtpDownload" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="ServiceID">drscharSFTP</parameter>
                    <parameter name="FilePattern">Catalog_[0-9]*\.xml</parameter>
                    <parameter name="SourceFolder">OUT</parameter>
                    <parameter name="TargetFolder">src/download</parameter>
                    <parameter name="Recursive">false</parameter>
                    <parameter name="DeleteRemoteFiles">true</parameter>
                    <parameter name="NoFileFoundStatus">OK</parameter>
                </parameters>
            </step>
        </flow>
        <flow>
            <context site-id="Sites"/>
            <step step-id="importCatalog" type="ImportCatalog" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="WorkingFolder">download</parameter>
                    <parameter name="FileNamePattern">Catalog_[0-9]*\.xml</parameter>
                    <parameter name="NoFilesFoundHandling">NO_FILES_FOUND</parameter>
                    <parameter name="ImportMode">Merge</parameter>
                    <parameter name="ImportFailedHandling">ERROR</parameter>
                    <parameter name="AfterImportFileHandling">Archive</parameter>
                    <parameter name="ArchiveFolder">archive</parameter>
                </parameters>
            </step>
        </flow>
        <rules>
            <on-exit status="ERROR" enabled="true">
                <send-mail>
                    <from>drschar-sfcc-staging@unitedvirtualities.com</from>
                    <to>Linda.Davidson@drschar.com</to>
                    <cc>ngarcia@unitedvirtualities.com, rcervantes@unitedvirtualities.com</cc>
                </send-mail>
            </on-exit>
        </rules>
        <triggers>
            <run-recurring enabled="true">
                <recurrence>
                    <date-from>2021-07-22Z</date-from>
                    <start-time>09:00:00.000Z</start-time>
                    <interval>30m</interval>
                    <day-of-week>
                        <weekday>Tuesday</weekday>
                        <weekday>Monday</weekday>
                        <weekday>Friday</weekday>
                        <weekday>Wednesday</weekday>
                        <weekday>Saturday</weekday>
                        <weekday>Sunday</weekday>
                        <weekday>Thursday</weekday>
                    </day-of-week>
                </recurrence>
            </run-recurring>
        </triggers>
    </job>

    <job job-id="PricebookImport" priority="0">
        <description/>
        <parameters/>
        <flow>
            <context site-id="Sites"/>
            <step step-id="download" type="custom.CSComponents.FtpDownload" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="ServiceID">drscharSFTP</parameter>
                    <parameter name="FilePattern">Pricebook_[0-9]*\.xml</parameter>
                    <parameter name="SourceFolder">OUT</parameter>
                    <parameter name="TargetFolder">src/download</parameter>
                    <parameter name="Recursive">false</parameter>
                    <parameter name="DeleteRemoteFiles">true</parameter>
                    <parameter name="NoFileFoundStatus">OK</parameter>
                </parameters>
            </step>
        </flow>
        <flow>
            <context site-id="Sites"/>
            <step step-id="import" type="ImportPriceBook" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="WorkingFolder">download</parameter>
                    <parameter name="FileNamePattern">Pricebook_[0-9]*\.xml</parameter>
                    <parameter name="NoFilesFoundHandling">NO_FILES_FOUND</parameter>
                    <parameter name="ImportMode">Merge</parameter>
                    <parameter name="ImportFailedHandling">WARN</parameter>
                    <parameter name="AfterImportFileHandling">Archive</parameter>
                    <parameter name="ArchiveFolder">archive</parameter>
                </parameters>
            </step>
        </flow>
        <rules>
            <on-exit status="ERROR" enabled="true">
                <send-mail>
                    <from>drschar-sfcc@unitedvirtualities.com</from>
                    <to>Linda.Davidson@drschar.com</to>
                    <cc>ngarcia@unitedvirtualities.com</cc>
                </send-mail>
            </on-exit>
        </rules>
        <triggers>
            <run-recurring enabled="true">
                <recurrence>
                    <date-from>2021-07-22Z</date-from>
                    <start-time>09:10:00.000Z</start-time>
                    <interval>30m</interval>
                    <day-of-week>
                        <weekday>Tuesday</weekday>
                        <weekday>Monday</weekday>
                        <weekday>Friday</weekday>
                        <weekday>Wednesday</weekday>
                        <weekday>Saturday</weekday>
                        <weekday>Sunday</weekday>
                        <weekday>Thursday</weekday>
                    </day-of-week>
                </recurrence>
            </run-recurring>
        </triggers>
    </job>

    <job job-id="InventoryImport" priority="0">
        <description/>
        <parameters/>
        <flow>
            <context site-id="Sites"/>
            <step step-id="download" type="custom.CSComponents.FtpDownload" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="ServiceID">drscharSFTP</parameter>
                    <parameter name="FilePattern">Inventory_[0-9]*\.xml</parameter>
                    <parameter name="SourceFolder">OUT</parameter>
                    <parameter name="TargetFolder">src/download</parameter>
                    <parameter name="Recursive">false</parameter>
                    <parameter name="DeleteRemoteFiles">true</parameter>
                    <parameter name="NoFileFoundStatus">OK</parameter>
                </parameters>
            </step>
        </flow>
        <flow>
            <context site-id="Sites"/>
            <step step-id="import" type="ImportInventoryLists" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="WorkingFolder">download</parameter>
                    <parameter name="FileNamePattern">Inventory_[0-9]*\.xml</parameter>
                    <parameter name="NoFilesFoundHandling">NO_FILES_FOUND</parameter>
                    <parameter name="ImportMode">Merge</parameter>
                    <parameter name="ImportFailedHandling">WARN</parameter>
                    <parameter name="AfterImportFileHandling">Archive</parameter>
                    <parameter name="ArchiveFolder">archive</parameter>
                </parameters>
            </step>
        </flow>
        <rules/>
        <triggers>
            <run-once enabled="false">
                <date>2021-06-03Z</date>
                <time>01:48:35.000Z</time>
            </run-once>
        </triggers>
    </job>

    <job job-id="marketingCloudSignupEmails" priority="0">
        <description/>
        <parameters/>
        <flow>
            <context site-id="Sites"/>
            <step step-id="exportXMLEmailFile" type="custom.getCustomObjectEmails" enforce-restart="false">
                <description/>
                <parameters>
                    <parameter name="CustomObjectType">marketingCustomer</parameter>
                </parameters>
            </step>
        </flow>
        <rules/>
        <triggers>
            <run-recurring enabled="false">
                <recurrence>
                    <date-from>2021-07-28Z</date-from>
                    <start-time>15:14:02.000Z</start-time>
                    <interval>1d</interval>
                    <day-of-week/>
                </recurrence>
            </run-recurring>
        </triggers>
    </job>

    <job job-id="tokenRenew" priority="0">
        <description>This job has been created to renew Instagram API token</description>
        <parameters/>
        <split sequential="false">
            <contexts template-ref="template_30">
                <all-storefront-sites/>
            </contexts>
            <flow-template template-id="template_30">
                <step step-id="getCustomObjectData" type="custom.getCustomObjects" enforce-restart="true">
                    <description>This will make a request to renew token for 60 days</description>
                    <parameters>
                        <parameter name="CustomObjectType">instagramToken</parameter>
                    </parameters>
                </step>
            </flow-template>
        </split>
        <rules/>
        <triggers>
            <run-recurring enabled="true">
                <recurrence>
                    <date-from>2021-10-01Z</date-from>
                    <start-time>04:00:00.000Z</start-time>
                    <interval>59d</interval>
                    <day-of-week>
                        <weekday>Tuesday</weekday>
                        <weekday>Monday</weekday>
                        <weekday>Friday</weekday>
                        <weekday>Wednesday</weekday>
                        <weekday>Saturday</weekday>
                        <weekday>Sunday</weekday>
                        <weekday>Thursday</weekday>
                    </day-of-week>
                </recurrence>
            </run-recurring>
        </triggers>
    </job>

    <job job-id="Yotpo Loyalty Order Export" priority="0">
        <description/>
        <parameters/>
        <flow>
            <context site-id="RefArch"/>
            <step step-id="YotpoLoyaltyOrderExport" type="custom.Yotpo.LoyaltyOrderExport" enforce-restart="false">
                <description/>
                <parameters/>
            </step>
        </flow>
        <rules/>
        <triggers>
            <run-recurring enabled="false">
                <recurrence>
                    <date-from>2019-08-08Z</date-from>
                    <start-time>06:00:00.000Z</start-time>
                    <interval>1d</interval>
                    <day-of-week>
                        <weekday>Tuesday</weekday>
                        <weekday>Monday</weekday>
                        <weekday>Friday</weekday>
                        <weekday>Wednesday</weekday>
                        <weekday>Saturday</weekday>
                        <weekday>Sunday</weekday>
                        <weekday>Thursday</weekday>
                    </day-of-week>
                </recurrence>
            </run-recurring>
        </triggers>
    </job>

    <job job-id="Yotpo Order Export (Purchase Feed)" priority="0">
        <description>This job exports high-level order information (name, email, products purchased, etc.) to Yotpo. Its primary purpose is to supply enough details for Yotpo to trigger "Review Your Product" emails after a preconfigured delay after purchase.Orders are sent to Yotpo in batches, grouped by locale. Additional connection details are configured in the "Manage Yotpo Configuration" Business Manager plugin. The "int_yotpo_sfra.https.post.export.purchase.api.cred" Service facilitates transmission of information.
	    </description>
        <parameters/>
        <flow>
            <context site-id="drschar"/>
            <step step-id="YotpoExportOrders" type="custom.Yotpo.ExportOrdersJson" enforce-restart="false">
                <description>Sends the order information to Yotpo's endpoint.</description>
                <parameters/>
                <rules>
                    <on-exit status="ERROR">
                        <continue/>
                    </on-exit>
                </rules>
            </step>
            <step step-id="YotpoJobErrorChecking" type="custom.Yotpo.JobErrorChecking" enforce-restart="true">
                <description>Checks previously run YotpoExportOrders step for errors.  Modifies job exit status if error exceed threshold</description>
                <parameters/>
                <rules>
                    <on-exit status="ERROR">
                        <stop-job/>
                    </on-exit>
                </rules>
            </step>
        </flow>
        <rules/>
        <triggers>
            <run-recurring enabled="false">
                <recurrence>
                    <date-from>2019-08-08Z</date-from>
                    <start-time>06:00:00.000Z</start-time>
                    <interval>1d</interval>
                    <day-of-week>
                        <weekday>Tuesday</weekday>
                        <weekday>Monday</weekday>
                        <weekday>Friday</weekday>
                        <weekday>Wednesday</weekday>
                        <weekday>Saturday</weekday>
                        <weekday>Sunday</weekday>
                        <weekday>Thursday</weekday>
                    </day-of-week>
                </recurrence>
            </run-recurring>
        </triggers>
    </job>

    <job job-id="Yotpo Loyalty Customer Export" priority="0">
        <description/>
        <parameters/>
        <flow>
            <context site-id="RefArch"/>
            <step step-id="LoyaltyCustomerExport" type="custom.Yotpo.LoyaltyCustomerExport" enforce-restart="false">
                <description/>
                <parameters/>
            </step>
        </flow>
        <rules/>
        <triggers>
            <run-recurring enabled="false">
                <recurrence>
                    <date-from>2019-08-08Z</date-from>
                    <start-time>06:00:00.000Z</start-time>
                    <interval>1d</interval>
                    <day-of-week>
                        <weekday>Tuesday</weekday>
                        <weekday>Monday</weekday>
                        <weekday>Friday</weekday>
                        <weekday>Wednesday</weekday>
                        <weekday>Saturday</weekday>
                        <weekday>Sunday</weekday>
                        <weekday>Thursday</weekday>
                    </day-of-week>
                </recurrence>
            </run-recurring>
        </triggers>
    </job>

</jobs>
